# ğŸ­ Chat-ç”„å¬› æ˜¯å¦‚ä½•ç‚¼æˆçš„ AMD ROCm ç‰ˆæœ¬

<div align='center'>

[![AMD](https://img.shields.io/badge/AMD-ROCm-ED1C24)](https://rocm.docs.amd.com/)


</div>

**Chat-ç”„å¬›**æ˜¯åˆ©ç”¨ã€Šç”„å¬›ä¼ ã€‹å‰§æœ¬ä¸­æ‰€æœ‰å…³äºç”„å¬›çš„å°è¯å’Œè¯­å¥ï¼ŒåŸºäºå¤§æ¨¡å‹è¿›è¡Œ**LoRAå¾®è°ƒ**å¾—åˆ°çš„æ¨¡ä»¿ç”„å¬›è¯­æ°”çš„èŠå¤©è¯­è¨€æ¨¡å‹ã€‚

> ç”„å¬›ï¼Œå°è¯´ã€Šåå®«Â·ç”„å¬›ä¼ ã€‹å’Œç”µè§†å‰§ã€Šç”„å¬›ä¼ ã€‹ä¸­çš„å¥³ä¸€å·ï¼Œæ ¸å¿ƒå¥³ä¸»è§’ã€‚åŸåç”„ç‰å¬›ï¼Œå«Œç‰å­—ä¿—æ°”è€Œæ”¹åç”„å¬›ï¼Œä¸ºæ±‰äººç”„è¿œé“ä¹‹å¥³ï¼Œåè¢«é›æ­£èµå§“é’®ç¥œç¦„æ°ï¼ŒæŠ¬æ——ä¸ºæ»¡æ´²ä¸Šä¸‰æ——ï¼Œè·åâ€œé’®ç¥œç¦„Â·ç”„å¬›â€ã€‚åŒæ²ˆçœ‰åº„ã€å®‰é™µå®¹å‚åŠ é€‰ç§€ï¼Œå› å®¹è²Œé…·ä¼¼çº¯å…ƒçš‡åè€Œè¢«é€‰ä¸­ã€‚å…¥å®«åé¢å¯¹åå¦ƒçš„æ­¥æ­¥ç´§é€¼ï¼Œæ²ˆçœ‰åº„è¢«å†¤ã€å®‰é™µå®¹å˜å¿ƒï¼Œä»åå®‰ä¸€éš…çš„é’æ¶©å°‘å¥³å˜æˆäº†èƒ½å¼•èµ·è¡€é›¨è…¥é£çš„å®«æ–—è€æ‰‹ã€‚é›æ­£å‘ç°å¹´æ°ä¸€æ—çš„é‡å¿ƒåä»¤å…¶çˆ¶ç”„è¿œé“å‰ªé™¤ï¼Œç”„å¬›ä¹Ÿäºåå®«ä¸­ç”¨å¥¹çš„è¿ç¯å·§è®¡å¸®çš‡å¸è§£å†³æ”¿æ•Œï¼Œæ•…è€Œæ·±å¾—é›æ­£çˆ±å¾…ã€‚å‡ ç»å‘¨æŠ˜ï¼Œç»ˆäºæ–—å®äº†åš£å¼ è·‹æ‰ˆçš„åå¦ƒã€‚ç”„å¬›å°å¦ƒæ—¶é­çš‡åå®œä¿®æš—ç®—ï¼Œè¢«çš‡ä¸Šå«Œå¼ƒï¼Œç”Ÿä¸‹å¥³å„¿èƒ§æœˆåå¿ƒç°æ„å†·ï¼Œè‡ªè¯·å‡ºå®«ä¸ºå°¼ã€‚ç„¶å¾—æœéƒ¡ç‹çˆ±æ…•ï¼ŒäºŒäººç›¸çˆ±ï¼Œå¾—çŸ¥æœéƒ¡ç‹æ­»è®¯åç«‹åˆ»è®¾è®¡ä¸é›æ­£å†é‡ï¼Œé£å…‰å›å®«ã€‚æ­¤åç”„çˆ¶å†¤æ¡ˆå¹³åã€ç”„æ°å¤èµ·ï¼Œå¥¹ä¹Ÿç”Ÿä¸‹åŒç”Ÿå­ï¼Œåœ¨æ»´è¡€éªŒäº²ç­‰å„ç§é˜´è°‹ä¸­èº²è¿‡å®œä¿®çš„æš—å®³ï¼Œæœ€åä»¥ç‰ºç‰²è‡ªå·±äº²ç”Ÿèƒå„¿çš„æ–¹å¼æ‰³å€’äº†å¹•åé»‘æ‰‹çš„çš‡åã€‚ä½†é›æ­£åˆé€¼ç”„å¬›æ¯’æ€å…ç¤¼ï¼Œä»¥æµ‹è¯•ç”„å¬›çœŸå¿ƒï¼Œå¹¶è®©å·²ç»ç”Ÿäº§è¿‡å­©å­çš„ç”„å¬›å»å‡†æ ¼å°”å’Œäº²ã€‚ç”„å¬›é‚è§†çš‡å¸ä¸ºæœ€è¯¥æ¯ç­çš„å¯¹è±¡ï¼Œå¤§ç»“å±€é“å°½â€œäººç±»çš„ä¸€åˆ‡äº‰æ–—ï¼Œçš†å› ç»Ÿæ²»è€…çš„ä¸å…¬ä¸ä¹‰è€Œèµ·â€ï¼Œå¹¶æ¯’æ€é›æ­£ã€‚å››é˜¿å“¥å¼˜å†ç™»åŸºä¸ºä¹¾éš†ï¼Œç”„å¬›è¢«å°Šä¸ºåœ£æ¯çš‡å¤ªåï¼Œæƒå€¾æœé‡ï¼Œåœ¨å¦‚æ‡¿ä¼ ä¸­å®‰åº¦æ™šå¹´ã€‚

Chat-ç”„å¬›ï¼Œå®ç°äº†ä»¥ã€Šç”„å¬›ä¼ ã€‹ä¸ºåˆ‡å…¥ç‚¹ï¼Œæ‰“é€ ä¸€å¥—åŸºäºå°è¯´ã€å‰§æœ¬çš„**ä¸ªæ€§åŒ– AI** å¾®è°ƒå¤§æ¨¡å‹å®Œæ•´æµç¨‹ï¼Œé€šè¿‡æä¾›ä»»ä¸€å°è¯´ã€å‰§æœ¬ï¼ŒæŒ‡å®šäººç‰©è§’è‰²ï¼Œè¿è¡Œæœ¬é¡¹ç›®å®Œæ•´æµç¨‹ï¼Œè®©æ¯ä¸€ä½ç”¨æˆ·éƒ½åŸºäºå¿ƒä»ªçš„å°è¯´ã€å‰§æœ¬æ‰“é€ ä¸€ä¸ªå±äºè‡ªå·±çš„ã€å¥‘åˆè§’è‰²äººè®¾ã€å…·å¤‡é«˜åº¦æ™ºèƒ½çš„ä¸ªæ€§åŒ– AIã€‚

> *Chat-å¬›å¬›æ¨¡å‹ç´¯è®¡ä¸‹è½½é‡ 15.6kï¼ŒModelscope åœ°å€ï¼š*[*Link*](https://www.modelscope.cn/models/kmno4zx/huanhuan-chat-internlm2)   
> *Chat-å¬›å¬›ç´¯è®¡è·å¾— 500 starï¼Œhuahuan-chat é¡¹ç›®åœ°å€ï¼š*[*Link*](https://github.com/KMnO4-zx/huanhuan-chat.git)ï¼Œxlab-huanhuan-chat é¡¹ç›®åœ°å€ï¼š[*Link*](https://github.com/KMnO4-zx/xlab-huanhuan.git)  


***OKï¼Œé‚£æ¥ä¸‹æ¥æˆ‘å°†ä¼šå¸¦é¢†å¤§å®¶äº²è‡ªåŠ¨æ‰‹ï¼Œä¸€æ­¥æ­¥å®ç° Chat-ç”„å¬› çš„è®­ç»ƒè¿‡ç¨‹ï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ¥ä½“éªŒä¸€ä¸‹å§~***

## Step 1: ç¯å¢ƒå‡†å¤‡

æœ¬æ–‡åŸºç¡€ç¯å¢ƒå¦‚ä¸‹ï¼š

```
----------------
windows 22.04
python 3.12
rocm 7.10.0
pytorch 2.9.1
----------------
```

é¦–å…ˆ `pip` æ¢æºåŠ é€Ÿä¸‹è½½å¹¶å®‰è£…ä¾èµ–åŒ…

```shell
# å‡çº§pip
python -m pip install --upgrade pip

# å®‰è£…rocm 
# å¦‚æœä¸º Ryzen ai 370 è¯·æ›¿æ¢ gfx1151->gfx1150 
python -m pip install --index-url https://repo.amd.com/rocm/whl/gfx1151/ "rocm[libraries,devel]"
python -m pip install --index-url https://repo.amd.com/rocm/whl/gfx1151/ torch torchvision torchaudio

# æ›´æ¢ pypi æºåŠ é€Ÿåº“çš„å®‰è£…
pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple


pip install modelscope==1.16.1
pip install transformers==4.43.1
pip install accelerate==0.32.1
pip install peft==0.11.1
pip install datasets==2.20.0
pip install huggingface_hub
```

> æœ¬é¡¹ç›®ä½¿ç”¨ Ryzen AI MAX 395/370 è¿è¡Œæµ‹è¯•ï¼Œå…¶ä»– Radeon ç³»åˆ—é€‚é…æƒ…å†µè¯·æŸ¥çœ‹ https://rocm.docs.amd.com/en/7.10.0-preview/rocm-for-ai/pytorch-comfyui.html

## Step 2: æ•°æ®å‡†å¤‡

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å‡†å¤‡ã€Šç”„å¬›ä¼ ã€‹å‰§æœ¬æ•°æ®ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº†ã€Šç”„å¬›ä¼ ã€‹å‰§æœ¬æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹ä¸€ä¸‹åŸå§‹æ•°æ®çš„æ ¼å¼ã€‚

```text
ç¬¬2å¹•
ï¼ˆé€€æœï¼Œç™¾å®˜æ•£å»ï¼‰
å®˜å‘˜ç”²ï¼šå’±ä»¬çš‡ä¸Šå¯çœŸæ˜¯å™¨é‡å¹´å°†å†›å’Œéš†ç§‘å¤šå¤§äººã€‚
å®˜å‘˜ä¹™ï¼šéš†ç§‘å¤šå¤§äººï¼Œæ­å–œæ­å–œå•Šï¼æ‚¨å¯æ˜¯å›½å®¶çš„å¤§åŠŸè‡£å•Šï¼
å®˜å‘˜ä¸™ï¼šå¹´å¤§å°†å†›ï¼Œçš‡ä¸Šå¯¹ä½ å¯æ˜¯å‚é’æœ‰åŠ å‘€ï¼
å®˜å‘˜ä¸ï¼šå¹´å¤§äººï¼Œæ‚¨å¯æ˜¯çš‡ä¸Šçš„è‚¡è‚±ä¹‹è‡£å“ªï¼
è‹åŸ¹ç››ï¼ˆè¿½ä¸Šå¹´ç¾¹å°§ï¼‰ï¼šå¹´å¤§å°†å†›è¯·ç•™æ­¥ã€‚å¤§å°†å†›â€”â€”
å¹´ç¾¹å°§ï¼šè‹å…¬å…¬ï¼Œæœ‰ä½•æŒ‡æ•™ï¼Ÿ
è‹åŸ¹ç››ï¼šä¸æ•¢ã€‚çš‡ä¸Šæƒ¦è®°å¤§å°†å†›æ‚¨çš„è‡‚ä¼¤ï¼Œç‰¹è®©å¥´æ‰å°†è¿™ç§˜åˆ¶çš„é‡‘åˆ›è¯è†äº¤ç»™å¤§äººï¼Œå«æ‚¨ä½¿ç”¨ã€‚
å¹´ç¾¹å°§ï¼ˆé¥å‘é‡‘éŠ®æ®¿æ‹±æ‰‹ï¼‰ï¼šè‡£å¹´ç¾¹å°§æ­è°¢çš‡ä¸Šåœ£æ©ï¼æ•¢é—®è‹å…¬å…¬ï¼Œå°å¦¹ä»Šæ—¥åœ¨å®«ä¸­å¯å¥½å•Šï¼Ÿ
è‹åŸ¹ç››ï¼šåå¦ƒå¨˜å¨˜å‡¤ä»ªä¸‡åƒã€å® å† å…­å®«å•Šï¼Œå¤§å°†å†›æ‚¨æ”¾å¿ƒå¥½äº†ã€‚
å¹´ç¾¹å°§ï¼šé‚£å°±æœ‰åŠ³è‹å…¬å…¬äº†ã€‚ï¼ˆè½¬èº«ç¦»å»ï¼‰
è‹åŸ¹ç››ï¼šåº”è¯¥çš„ã€‚
```

æ¯ä¸€å¥éƒ½æœ‰äººç‰©åŠå¯¹åº”çš„å°è¯ï¼Œæ‰€ä»¥å°±å¯ä»¥å¾ˆç®€å•çš„å°†è¿™äº›æ•°æ®å¤„ç†æˆå¯¹è¯çš„å½¢å¼ï¼Œå¦‚ä¸‹ï¼š

```
[
    {"rloe":"å®˜å‘˜ç”²", "content":"å’±ä»¬çš‡ä¸Šå¯çœŸæ˜¯å™¨é‡å¹´å°†å†›å’Œéš†ç§‘å¤šå¤§äººã€‚"},
    {"rloe":"å®˜å‘˜ä¹™", "content":"éš†ç§‘å¤šå¤§äººï¼Œæ­å–œæ­å–œå•Šï¼æ‚¨å¯æ˜¯å›½å®¶çš„å¤§åŠŸè‡£å•Šï¼"},
    {"rloe":"å®˜å‘˜ä¸™", "content":"å¹´å¤§å°†å†›ï¼Œçš‡ä¸Šå¯¹ä½ å¯æ˜¯å‚é’æœ‰åŠ å‘€ï¼"},
    {"rloe":"å®˜å‘˜ä¸", "content":"å¹´å¤§äººï¼Œæ‚¨å¯æ˜¯çš‡ä¸Šçš„è‚¡è‚±ä¹‹è‡£å“ªï¼"},
    {"rloe":"è‹åŸ¹ç››", "content":"å¹´å¤§å°†å†›è¯·ç•™æ­¥ã€‚å¤§å°†å†›â€”â€”"},
    ...
]
```

ç„¶åå†å°†æˆ‘ä»¬å…³æ³¨çš„è§’è‰²çš„å¯¹è¯æå–å‡ºæ¥ï¼Œå½¢æˆ QA é—®ç­”å¯¹ã€‚å¯¹äºè¿™æ ·çš„æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æˆ–è€…å…¶ä»–æ–¹æ³•è¿›è¡Œå¿«é€Ÿçš„æå–ï¼Œå¹¶æŠ½å–å‡ºæˆ‘ä»¬å…³æ³¨çš„è§’è‰²çš„å¯¹è¯ã€‚

ç„¶åå¾ˆå¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰è¿™æ ·ä¼˜ç§€çš„å°è¯æ ¼å¼æ•°æ®ã€‚æ‰€ä»¥æˆ‘ä»¬å¯èƒ½å°±éœ€è¦ä»ä¸€å¤§æ®µæ–‡æœ¬ä¸­æŠ½å–è§’è‰²çš„å¯¹è¯æ•°æ®ï¼Œç„¶åå°†å…¶è½¬æ¢æˆæˆ‘ä»¬éœ€è¦çš„æ ¼å¼ã€‚

æ¯”å¦‚ã€Šè¥¿æ¸¸è®°ç™½è¯æ–‡ã€‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä»–çš„æ–‡æœ¬æ˜¯è¿™æ ·çš„ã€‚å¯¹äºè¿™æ ·çš„æ–‡æœ¬ï¼Œé‚£æˆ‘ä»¬å°±éœ€è¦å€ŸåŠ©å¤§æ¨¡å‹çš„èƒ½åŠ›ï¼Œä»æ–‡æœ¬ä¸­æå–å‡ºè§’è‰²å’Œè§’è‰²å¯¹åº”çš„å¯¹è¯ã€‚ç„¶åå†ç­›é€‰å‡ºæˆ‘ä»¬éœ€è¦çš„è§’è‰²å¯¹è¯ã€‚

> å¯ä»¥å€ŸåŠ©ä¸€ä¸ªå°å·¥å…·ï¼š[*extract-dialogue*](https://github.com/KMnO4-zx/extract-dialogue.git) ä»æ–‡æœ¬ä¸­æå–å¯¹è¯ã€‚
    
```
......
åŸæ¥å­™æ‚Ÿç©ºèµ°äº†ä»¥åï¼Œæœ‰ä¸€ä¸ªæ··ä¸–é­”ç‹ç‹¬å äº†æ°´å¸˜æ´ï¼Œå¹¶ä¸”æŠ¢èµ°äº†è®¸å¤šçŒ´å­çŒ´å­™ã€‚å­™æ‚Ÿç©ºå¬åˆ°è¿™äº›ä»¥åï¼Œæ°”å¾—å’¬ç‰™è·ºè„šã€‚ä»–é—®æ¸…äº†æ··ä¸–é­”ç‹çš„ä½å¤„ï¼Œå†³å®šæ‰¾æ··ä¸–é­”ç‹æŠ¥ä»‡ï¼Œä¾¿é©¾ç€ç­‹æ–—äº‘ï¼ŒæœåŒ—æ–¹é£å»ã€‚

ä¸ä¸€ä¼šå„¿ï¼Œå­™æ‚Ÿç©ºå°±æ¥åˆ°æ··ä¸–é­”ç‹çš„æ°´è„æ´å‰ï¼Œå¯¹é—¨å‰çš„å°å¦–å–Šåˆ°âˆ¶â€œä½ å®¶é‚£ä¸ªç‹—å±é­”ç‹ï¼Œå¤šæ¬¡æ¬ºè´Ÿæˆ‘ä»¬çŒ´å­ã€‚æˆ‘ä»Šå¤©æ¥ï¼Œè¦å’Œé‚£é­”ç‹æ¯”æ¯”é«˜ä½ï¼

â€å°å¦–è·‘è¿›æ´é‡Œï¼ŒæŠ¥å‘Šé­”ç‹ã€‚é­”ç‹æ€¥å¿™ç©¿ä¸Šé“ç”²ï¼Œæç€å¤§åˆ€ï¼Œåœ¨å°å¦–ä»¬çš„ç°‡æ‹¥ä¸‹èµ°å‡ºæ´é—¨ã€‚

å­™æ‚Ÿç©ºèµ¤æ‰‹ç©ºæ‹³ï¼Œå¤ºè¿‡äº†æ··ä¸–é­”ç‹çš„å¤§åˆ€ï¼ŒæŠŠä»–åŠˆæˆäº†ä¸¤åŠã€‚ç„¶åï¼Œæ‹”ä¸‹ä¸€æŠŠæ¯«æ¯›å’¬ç¢å–·äº†å‡ºå»ï¼Œæ¯«æ¯›å˜æˆè®¸å¤šå°çŒ´å­ï¼Œç›´æ€è¿›æ´é‡Œï¼ŒæŠŠæ‰€æœ‰çš„å¦–ç²¾å…¨æ€æ­»ï¼Œç„¶åæ•‘å‡ºè¢«æŠ¢èµ°çš„å°çŒ´å­ï¼Œæ”¾äº†ä¸€æŠŠç«çƒ§äº†æ°´è„æ´ã€‚
......
```

> chat-ç”„å¬› çš„åŸå§‹æ•°æ®ï¼š[*ç”„å¬›ä¼ *](https://github.com/KMnO4-zx/huanhuan-chat/tree/master/dataset/input/huanhuan)  
> è¥¿æ¸¸è®°ç™½è¯æ–‡åŸå§‹æ•°æ®ï¼š[*è¥¿æ¸¸è®°*](https://github.com/KMnO4-zx/huanhuan-chat/blob/master/dataset/input/wukong/%E8%A5%BF%E6%B8%B8%E8%AE%B0%E7%99%BD%E8%AF%9D%E6%96%87.txt)

æœ€åå†å°†å…¶æ•´ç†æˆ `json` æ ¼å¼çš„æ•°æ®ï¼Œå¦‚ä¸‹ï¼š

```
[
    {
        "instruction": "å°å§ï¼Œåˆ«çš„ç§€å¥³éƒ½åœ¨æ±‚ä¸­é€‰ï¼Œå”¯æœ‰å’±ä»¬å°å§æƒ³è¢«æ’‚ç‰Œå­ï¼Œè©è¨ä¸€å®šè®°å¾—çœŸçœŸå„¿çš„â€”â€”",
        "input": "",
        "output": "å˜˜â€”â€”éƒ½è¯´è®¸æ„¿è¯´ç ´æ˜¯ä¸çµçš„ã€‚"
    },
    {
        "instruction": "è¿™ä¸ªæ¸©å¤ªåŒ»å•Šï¼Œä¹Ÿæ˜¯å¤æ€ªï¼Œè°ä¸çŸ¥å¤ªåŒ»ä¸å¾—çš‡å‘½ä¸èƒ½ä¸ºçš‡æ—ä»¥å¤–çš„äººè¯·è„‰è¯Šç—…ï¼Œä»–å€’å¥½ï¼Œåå¤©åŠæœˆä¾¿å¾€å’±ä»¬åºœé‡Œè·‘ã€‚",
        "input": "",
        "output": "ä½ ä»¬ä¿©è¯å¤ªå¤šäº†ï¼Œæˆ‘è¯¥å’Œæ¸©å¤ªåŒ»è¦ä¸€å‰‚è¯ï¼Œå¥½å¥½æ²»æ²»ä½ ä»¬ã€‚"
    },
    {
        "instruction": "å¬›å¦¹å¦¹ï¼Œåˆšåˆšæˆ‘å»åºœä¸Šè¯·è„‰ï¼Œå¬ç”„ä¼¯æ¯è¯´ä½ æ¥è¿™é‡Œè¿›é¦™äº†ã€‚",
        "input": "",
        "output": "å‡ºæ¥èµ°èµ°ï¼Œä¹Ÿæ˜¯æ•£å¿ƒã€‚"
    }
]
```

> Chat-å¬›å¬› çš„æ•°æ®ï¼š[*chat-ç”„å¬›*](https://github.com/datawhalechina/self-llm/blob/master/dataset/huanhuan.json)

æ‰€ä»¥ï¼Œåœ¨è¿™ä¸€æ­¥å¤„ç†æ•°æ®çš„å¤§è‡´æ€è·¯å°±æ˜¯ï¼š

***1. ä»åŸå§‹æ•°æ®ä¸­æå–å‡ºè§’è‰²å’Œå¯¹è¯ &emsp;2. ç­›é€‰å‡ºæˆ‘ä»¬å…³æ³¨çš„è§’è‰²çš„å¯¹è¯ &emsp;3. å°†å¯¹è¯è½¬æ¢æˆæˆ‘ä»¬éœ€è¦çš„æ ¼å¼***

> *è¿™ä¸€æ­¥ä¹Ÿå¯ä»¥å¢åŠ æ•°æ®å¢å¼ºçš„ç¯èŠ‚ï¼Œæ¯”å¦‚åˆ©ç”¨ä¸¤åˆ°ä¸‰æ¡æ•°æ®ä½œä¸º example ä¸¢ç»™LLMï¼Œè®©å…¶ç”Ÿæˆé£æ ¼ç±»ä¼¼çš„æ•°æ®ã€‚å†æˆ–è€…ä¹Ÿå¯ä»¥æ‰¾ä¸€éƒ¨åˆ†æ—¥å¸¸å¯¹è¯çš„æ•°æ®é›†ï¼Œä½¿ç”¨ RAG ç”Ÿæˆä¸€äº›å›ºå®šè§’è‰²é£æ ¼çš„å¯¹è¯æ•°æ®ã€‚è¿™é‡Œå¤§å®¶å¯ä»¥å®Œå…¨æ”¾å¼€çš„å¤§èƒ†å»å°è¯•ï¼*

## Step 3: æ¨¡å‹è®­ç»ƒ

é‚£è¿™ä¸€æ­¥ï¼Œå¤§å®¶å¯èƒ½å†ç†Ÿæ‚‰ä¸è¿‡äº†ã€‚åœ¨`self-llm`çš„æ¯ä¸€ä¸ªæ¨¡å‹ä¸­ï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ª `Lora` å¾®è°ƒæ¨¡å—ï¼Œæˆ‘ä»¬åªéœ€è¦å°†æ•°æ®å¤„ç†æˆæˆ‘ä»¬éœ€è¦çš„æ ¼å¼ï¼Œç„¶åå†è°ƒç”¨æˆ‘ä»¬çš„è®­ç»ƒè„šæœ¬å³å¯ã€‚

æ­¤å¤„é€‰æ‹©æˆ‘ä»¬é€‰æ‹© `LLaMA3_1-8B-Instruct` æ¨¡å‹è¿›è¡Œå¾®è°ƒï¼Œé¦–å…ˆè¿˜æ˜¯è¦ä¸‹è½½æ¨¡å‹ï¼Œåˆ›å»ºä¸€ä¸ª`model_download.py`æ–‡ä»¶ï¼Œè¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š

```python
import torch
from modelscope import snapshot_download, AutoModel, AutoTokenizer
import os

model_dir = snapshot_download('LLM-Research/Meta-Llama-3.1-8B-Instruct', cache_dir='/root/autodl-tmp', revision='master')

# Hugging Face ä¸‹è½½æ–¹å¼
# from huggingface_hub import snapshot_download
# model_dir = snapshot_download(repo_id='meta-llama/Meta-Llama-3.1-8B-Instruct', cache_dir='/root/autodl-tmp')
```

> æ³¨æ„ï¼šè®°å¾—ä¿®æ”¹ `cache_dir` ä¸ºä½ çš„æ¨¡å‹ä¸‹è½½è·¯å¾„å“¦~

å…¶æ¬¡ï¼Œå‡†å¤‡è®­ç»ƒä»£ç ã€‚å¯¹äºç†Ÿæ‚‰ `self-llm` çš„åŒå­¦æ¥è¯´ï¼Œè¿™ä¸€æ­¥å¯èƒ½å†ç®€å•ä¸è¿‡äº†ï¼Œåœ¨æ­¤å¤„æˆ‘ä¼šåœ¨å½“å‰ç›®å½•ä¸‹æ”¾ç½®`train.py`ï¼Œå¤§å®¶ä¿®æ”¹å…¶ä¸­çš„æ•°æ®é›†è·¯å¾„å’Œæ¨¡å‹è·¯å¾„å³å¯ã€‚

> *å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ `self-llm` ä¸­çš„ `lora` å¾®è°ƒæ•™ç¨‹ã€‚æ•™ç¨‹åœ°å€ï¼š[Link](https://github.com/datawhalechina/self-llm/blob/master/models/LLaMA3/04-LLaMA3-8B-Instruct%20Lora%20%E5%BE%AE%E8%B0%83.md)*

åœ¨å‘½ä»¤è¡Œè¿è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼š
    
```shell
python train.py
```

> *æ³¨æ„ï¼šè®°å¾—ä¿®æ”¹ `train.py` ä¸­çš„æ•°æ®é›†è·¯å¾„å’Œæ¨¡å‹è·¯å¾„å“¦~*

è®­ç»ƒå¤§æ¦‚ä¼šéœ€è¦ *1 ~ 3* å°æ—¶çš„æ—¶é—´ï¼Œè®­ç»ƒå®Œæˆä¹‹åä¼šåœ¨`output`ç›®å½•ä¸‹ç”Ÿæˆ`lora`æ¨¡å‹ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç è¿›è¡Œæµ‹è¯•ï¼š

```python
from transformers import AutoModelForCausalLM, AutoTokenizer
import torch
from peft import PeftModel

mode_path = './LLM-Research/Meta-Llama-3___1-8B-Instruct'
lora_path = './output/llama3_1_instruct_lora/checkpoint-699' # è¿™é‡Œæ”¹ç§°ä½ çš„ lora è¾“å‡ºå¯¹åº” checkpoint åœ°å€

# åŠ è½½tokenizer
tokenizer = AutoTokenizer.from_pretrained(mode_path, trust_remote_code=True)

# åŠ è½½æ¨¡å‹
model = AutoModelForCausalLM.from_pretrained(mode_path, device_map="auto",torch_dtype=torch.bfloat16, trust_remote_code=True).eval()

# åŠ è½½loraæƒé‡
model = PeftModel.from_pretrained(model, model_id=lora_path)

prompt = "å¬›å¬›ä½ æ€ä¹ˆäº†ï¼Œæœ•æ›¿ä½ æ‰“æŠ±ä¸å¹³ï¼"

messages = [
        {"role": "system", "content": "å‡è®¾ä½ æ˜¯çš‡å¸èº«è¾¹çš„å¥³äºº--ç”„å¬›ã€‚"},
        {"role": "user", "content": prompt}
]

input_ids = tokenizer.apply_chat_template(messages, tokenize=False, add_generation_prompt=True)

# print(input_ids)

model_inputs = tokenizer([input_ids], return_tensors="pt").to('cuda')
generated_ids = model.generate(model_inputs.input_ids,max_new_tokens=512)

generated_ids = [
    output_ids[len(input_ids):] for input_ids, output_ids in zip(model_inputs.input_ids, generated_ids)
]
response = tokenizer.batch_decode(generated_ids, skip_special_tokens=True)[0]
print('çš‡ä¸Šï¼š', prompt)
print('å¬›å¬›ï¼š',response)
```

```
çš‡ä¸Šï¼š å¬›å¬›ä½ æ€ä¹ˆäº†ï¼Œæœ•æ›¿ä½ æ‰“æŠ±ä¸å¹³ï¼
å¬›å¬›ï¼š çš‡ä¸Šï¼Œè‡£å¦¾ä¸æ˜¯æ•…æ„çš„ã€‚
```

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªå¬›å¬›æ¨¡å‹è¿›è¡Œå¯¹è¯äº†~   
æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥å°è¯•ä½¿ç”¨ `self-llm` ä¸­çš„å…¶ä»–æ¨¡å‹è¿›è¡Œå¾®è°ƒï¼Œæ£€éªŒä½ çš„å­¦ä¹ æˆæœï¼

## å†™åœ¨æœ€å

*Chat-å¬›å¬›æ˜¯åœ¨å»å¹´LLMåˆšç«èµ·æ¥çš„æ—¶å€™ï¼Œæˆ‘ä»¬è§‰å¾—å¦‚æœä¸åšç‚¹ä»€ä¹ˆçš„è¯ï¼Œå¯èƒ½ä¼šé”™è¿‡å¾ˆå¤šæœ‰è¶£çš„äº‹æƒ…ã€‚äºæ˜¯å°±å’Œå‡ ä¸ªå°ä¼™ä¼´ä¸€èµ·ï¼ŒèŠ±äº†å¾ˆå¤šæ—¶é—´ï¼Œåšäº†è¿™ä¸ªé¡¹ç›®ã€‚åœ¨è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å­¦åˆ°äº†å¾ˆå¤šï¼Œä¹Ÿé‡åˆ°äº†å¾ˆå¤šé—®é¢˜ï¼Œä½†æ˜¯æˆ‘ä»¬éƒ½ä¸€ä¸€è§£å†³äº†ã€‚å¹¶ä¸”Chat-å¬›å¬›ä¹Ÿè·å¾—äº†å¥–é¡¹ï¼Œè®©é¡¹ç›®å¾—åˆ°äº†å¾ˆå¤šäººçš„å…³æ³¨ã€‚æ‰€ä»¥ï¼Œæˆ‘è§‰å¾—è¿™ä¸ªé¡¹ç›®æ˜¯éå¸¸æœ‰æ„ä¹‰çš„ï¼Œä¹Ÿæ˜¯éå¸¸æœ‰è¶£çš„ã€‚*

- *2023 è®¯é£æ˜Ÿç«æ¯äººè®¤çŸ¥å¤§æ¨¡å‹åœºæ™¯åˆ›æ–°èµ› Top50*
- *2024 ä¹¦ç”ŸÂ·æµ¦è¯­å¤§æ¨¡å‹æŒ‘æˆ˜èµ›ï¼ˆæ˜¥å­£èµ›ï¼‰åˆ›æ„åº”ç”¨å¥– Top12*

### Chat-å¬›å¬›è´¡çŒ®è€…

- [å®‹å¿—å­¦](https://github.com/KMnO4-zx)ï¼ˆDatawhaleæˆå‘˜-ä¸­å›½çŸ¿ä¸šå¤§å­¦(åŒ—äº¬)ï¼‰
- [é‚¹é›¨è¡¡](https://github.com/logan-zou)ï¼ˆDatawhaleæˆå‘˜-å¯¹å¤–ç»æµè´¸æ˜“å¤§å­¦ï¼‰
- [ç‹ç† æ˜](https://github.com/Bald0Wang)ï¼ˆDatawhaleæˆå‘˜-å®å¤å¤§å­¦ï¼‰
- [é‚“å®‡æ–‡](https://github.com/GKDGKD)ï¼ˆDatawhaleæˆå‘˜-å¹¿å·å¤§å­¦ï¼‰
- [æœæ£®](https://github.com/coderdeepstudy)ï¼ˆDatawhaleæˆå‘˜-å—é˜³ç†å·¥å­¦é™¢ï¼‰
- [è‚–é¸¿å„’](https://github.com/Hongru0306)ï¼ˆDatawhaleæˆå‘˜-åŒæµå¤§å­¦ï¼‰